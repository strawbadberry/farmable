<!-- src/app/order/order.component.html -->
<div class="filter-section">
    <div class="dropdown-container">
        <button class="dropdown-button" (click)="toggleStatusDropdown($event)">
            {{selectedStatus}} ({{filteredCount}})
            <svg class="dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>
        <!-- Status dropdown content -->
        <div class="dropdown-content" [class.show]="showStatusDropdown">
            <a (click)="filterByStatus('all')" [class.active]="selectedStatus === 'all'">All</a>
            <a (click)="filterByStatus('pending')" [class.active]="selectedStatus === 'pending'">Pending</a>
            <a (click)="filterByStatus('accepted')" [class.active]="selectedStatus === 'accepted'">Accepted</a>
            <a (click)="filterByStatus('completed')" [class.active]="selectedStatus === 'completed'">Completed</a>
        </div>
    </div>

    <div class="dropdown-container">
        <button class="dropdown-button" (click)="toggleSortDropdown($event)">
            Sort by: {{selectedSort}}
            <svg class="dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
        </button>
        <!-- Sort dropdown content -->
        <div class="dropdown-content" [class.show]="showSortDropdown">
            <a (click)="sortOrders('newest')" [class.active]="selectedSort === 'newest'">Newest first</a>
            <a (click)="sortOrders('oldest')" [class.active]="selectedSort === 'oldest'">Oldest first</a>
            <a (click)="sortOrders('transactions-high')" [class.active]="selectedSort === 'transactions-high'">Most transactions</a>
            <a (click)="sortOrders('transactions-low')" [class.active]="selectedSort === 'transactions-low'">Least transactions</a>
        </div>
    </div>
    
    <!-- Auto-accept toggle button -->
    <div class="auto-accept-container">
        <span class="auto-accept-label">Auto-accept orders</span>
        <label class="toggle-switch">
            <input type="checkbox" [(ngModel)]="autoAcceptEnabled">
            <span class="toggle-slider"></span>
        </label>
    </div>
</div>

<!-- 这里只展示页面标题部分的修改 -->
<!-- 替换原来的固定标题 -->
<h1 class="page-title">
    {{selectedStatus === 'all' ? 'All Orders' : 
      selectedStatus === 'pending' ? 'Pending Acceptance' : 
      selectedStatus === 'accepted' ? 'Accepted Orders' :
      selectedStatus === 'completed' ? 'Completed Orders' : 
      'Orders'}} ({{filteredCount}})
  </h1>

<!-- Loading state -->
<div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading orders...</p>
</div>

<!-- Error state -->
<div *ngIf="error" class="error-message">
    {{ error }}
</div>

<!-- Orders list -->
<div *ngIf="!isLoading && !error" class="space-y-4">
    <div *ngFor="let order of filteredOrders" class="order-card">

        <div class="order-header-section">
            <div class="order-header">{{ order.customer.name || 'Customer' }}</div>
            <div class="order-subtext">Total transactions: {{ order.customer.transaction_count || 0 }} completed</div>
            <span [class]="'status-badge ' + getStatusClass(order.status)">
                {{ order.status }}
            </span>
        </div>

        <div class="order-content">
            <div class="order-info">
                <strong>Order #{{ order.order_id }}</strong><br>
                <strong>Placed on:</strong> {{ formatDate(order.order_date) }}<br>
                <strong>Required date:</strong> {{ formatDate(order.required_date) }} <br>
                <strong>Total order value:</strong> {{ formatCurrency(order.total_amount) }}
            </div>

            <div class="table-container">
                <table class="order-table">
                    <tr>
                        <th>Item</th>
                        <th>Request</th>
                        <th>Inventory</th>
                        <th>Shortage</th>
                        <th>Status</th>
                        <th>System note</th>
                    </tr>
                    <tr *ngFor="let item of order.order_items">
                        <td>{{ item.product.productName || 'Product' }}</td>
                        <td>{{ item.requested_quantity }}{{ item.product.packUnit || '' }}</td>
                        <td>{{ item.fulfilled_quantity || 0 }}{{ item.product.packUnit || '' }}</td>
                        <td>{{ item.remaining_quantity || 0 }}{{ item.product.packUnit || '' }}</td>
                        <td class="status-icon" [ngClass]="{
                            'status-success': item.status === 'completed',
                            'status-fail': item.status === 'pending' || item.status === 'cancelled'
                        }">
                            {{ item.status === 'completed' ? '✓' : '×' }}
                        </td>
                        <td class="system-note" [ngClass]="{ 'error': item.system_note }">
                            {{ item.system_note || 'N/A' }}
                        </td>
                    </tr>
                </table>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="contact-button" (click)="contactBuyer(order)">
                    Contact Buyer
                </button>
                <button class="view-button" (click)="viewOrderDetails(order)">
                    View Detail
                </button>
            </div>
        </div>
    </div>
    
    <!-- No orders message -->
    <div *ngIf="filteredOrders.length === 0" class="no-orders-message">
        No orders found.
    </div>
</div>